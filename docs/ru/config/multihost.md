---
title: мультихост
lastChanged: 13.09.2018
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/config/multihost.md
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
hash: eqCCAsh33eBCCR0QphOwh20ohrm79vbWAYxCeQhMDcs=
---
# Многохостовая работа
ioBroker может позволить нескольким серверам выполнять работу. Это позволяет распределять вычислительную нагрузку между несколькими хостами.
Но вы также можете использовать специфичные для системы расширения одноплатного компьютера (GPIO от RaspberryPi, хотя «основной компьютер» — более мощный Intel NUC).

После создания многохостовой системы все настройки выполняются централизованно через администратора мастера. Доступ к администратору ведомых устройств больше невозможен через их веб-интерфейсы.

Поэтому имеет смысл использовать для слейва хост с минимальной установкой, т.е. только js-контроллер и админку.

## Установка
### Основная конфигурация
Выполните следующую команду на мастере:

**Этот шаг абсолютно необходим, если используется Redis DB.** В других случаях его можно использовать, если автоматический метод (см. ниже) не работает. Тогда выберите f(ile) вместо r(edis)!

через консоль звоните:

1. «Пользовательская настройка iobroker»

Заполните меню, которое появляется следующим образом

```
Type of objects DB [(f)ile, (c)ouch, (r)edis], default [file]: f
Host / Unix Socket of objects DB(file), default[0.0.0.0]:
Port of objects DB(file), default[9001]:
Type of states DB [(f)file, (r)edis], default [file]: r
Host / Unix Socket of states DB (redis), default[127.0.0.1]: 0.0.0.0
Port of states DB (redis), default[6379]:
Data directory (file), default[../../../iobroker-data/]: /opt/iobroker/iobroker-data/
Host name of this machine [ioBroker-RasPi]:
```

2. `iobroker multihost enable`

``` enter pass phrase```

3. `iobroker перезапуск`

### Конфигурация подчиненного устройства
**Этот шаг абсолютно необходим, если используется Redis DB.**

Пожалуйста, войдите через консоль на раб.

1. «Пользовательская настройка iobroker»

Заполните меню, которое появляется следующим образом

```
Type of objects DB [(f)ile, (c)ouch, (r)edis], default [file]: f
Host / Unix Socket of objects DB(file), default[127.0.0.1]: <MASTER-IP>
Port of objects DB(file), default[9001]:
Type of states DB [(f)file, (r)edis], default [file]: r
Host / Unix Socket of states DB (redis), default[<MASTER-IP>]:
Port of states DB (redis), default[6379]:
Host name of this machine [raspi-sub-1]:
```

в конце появляется информация:

```
creating conf/iobroker.json
```

2. `iobroker multihost connect`

и заполните следующие диалоги соответствующим образом:

```
1 |       <MASTER-IP> |  host |       192.168.86.42 | "authentication required"
Please select host [1]: 1
Enter secret phrase for connection: *****

Config ok. Please restart ioBroker: "iobroker restart"
```

2. `iobroker перезапуск`

Вновь созданный хост появится в основной системе в разделе Hosts.

Если этого не произошло, перезагрузите оба хоста. сначала хозяин, потом раб.

## Мультихост с разными подсетями
Если оба хоста ioBroker находятся в разных подсетях,...

Пример:

* Обычная локальная сеть (для ПК, планшета и т. д.) = 192.168.178.0/24.
* ЛВС IoT (для Shelly, камер и т. д.) = 10.20.30.0/24

... автоматический мультихост ("iobroker multihost enable" и "iobroker multihostBrowse") не работает, только по-старому (`iobroker setup custom`) см. выше

## Мультихост с Redis
Если необходимо установить многохостовую среду, в которой состояния хранятся в Redis, необходимо учитывать еще несколько моментов.

Файл redis.conf на хосте, где хранятся состояния, необходимо изменить следующим образом.

```
nano /etc/redis/redis.conf
```

Содержащуюся в ней строку `bind 127.0.0.1` необходимо дополнить IP-адресом сетевого адаптера, чтобы сервер Redis разрешал внешние подключения.

Так например

```
bind 127.0.0.1 192.168.1.10
```

предполагая, что 192.168.1.10 является локальным IP-адресом мастера ioBroker.

Эта настройка необходима только на мастере.

Альтернативно также работает

```
bind 0.0.0.0
```

Наконец, перезапустите сервер или компьютер Redis. например:

```
sudo service redis-server restart
```

## Распределить задачи
Существует два способа распределения задач между хостами.

* Если это новая установка, на вкладке Адаптер выберите хост, на который должен быть установлен экземпляр адаптера, из раскрывающегося меню над списком адаптеров.

Затем добавьте экземпляр туда, нажав на (+) в правом столбце.

* Если вы уже установили на хост много адаптеров, впоследствии вы можете изменить назначение уже установленных экземпляров на вкладке Экземпляры.

## Удалить хост
Чтобы удалить хост, активируйте экспертный режим в админке на вкладке Объекты мастера и активируйте выбор хоста в колонке Тип. Затем удалите нужный хост.

## Возможные проблемы
иногда появляется сообщение похожее на:

```> ... bytes ... in strict mode```

Затем отредактируйте файл, в котором это происходит, с помощью редактора nano. `'use strict';` находится прямо в начале этой строки с // комментарием и сохранением.

```> IP Address of the host is 127.0.0.1. It accepts no connections. Please change.```

если вы не выполнили ``` setup custom ``` в мастер-системе