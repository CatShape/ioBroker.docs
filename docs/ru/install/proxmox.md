---
title: Проксмокс
Version: 0.2
Autoren: TeNNo2k5, crunchip
Schlüsselworte: Proxmox, VM, LXC, USB Passthrough, Usb-Backup
lastChanged: 12.08.2023
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/install/proxmox.md
hash: FRNF0eft/LaCJQVSJhYkS0UKIzaPwujbe+4BZ0VQxEY=
---
# Проксмокс
![логотип proxmox](../../de/install/media/proxmox/Proxmox-logo-860.png)

## Установка проксмокса
Proxmox Virtual Environment (сокращенно Proxmox VE) — это платформа виртуализации на базе Debian. Технология виртуализации в Proxmox основана на QEMU/KVM.

Proxmox «упаковывает» QEMU/KVM в собственный веб-интерфейс и, таким образом, упрощает администрирование (а также поддерживает контейнеры Linux — LXC). Это делает Proxmox, с одной стороны, удобным для начинающих, а с другой стороны, настолько мощным, что его можно использовать и в профессиональной среде.

В этом разделе показан пример установки и базовой настройки Proxmox в бесплатной версии (без подписки).

Для ясности описания изображений и дополнительную информацию можно открыть.

### Требования
<details><summary>требования</summary>

- 64-битный процессор
- ЦП и материнская плата должны поддерживать Intel VT/AMD-V для виртуализации и быть активированы в BIOS.
- 1 ГБ оперативной памяти (только для Proxmox) - в зависимости от количества виртуальных машин, которые будут работать, здесь, конечно, требуется больше оперативной памяти. Поэтому рекомендуется минимум 8 ГБ, а еще лучше 16 ГБ оперативной памяти.

</детали>

### Создать ISO-образ/загрузочную флешку
Сначала вам понадобится образ ISO, который можно загрузить с [Страница загрузки Proxmox](https://www.proxmox.com/de/downloads/category/iso-images-pve).

<details><summary>Проксмокс Изо</summary>

![proxmox-iso](../../de/install/media/proxmox/proxmox-iso.png)

</детали>

Для установки необходимо создать загрузочную флешку с этим ISO-образом. Это должно иметь по крайней мере 2 ГБ памяти. Существует несколько способов создания загрузочной флешки, см. [Подготовьте установочный носитель](https://pve.proxmox.com/wiki/Prepare_Installation_Media#_instructions_for_windows)

### Монтаж
Система должна быть настроена в UEFI/BIOS, чтобы ее можно было запустить с USB-устройства. После вставки USB-накопителя через короткое время появится меню установки Proxmox (если нет, вы также можете указать USB-накопитель в качестве загрузочного носителя вручную (на большинстве материнских плат это можно сделать с помощью F8 или F11).

**Установить Proxmox VE** теперь можно просто выбрать в меню установки.

<details><summary>Меню установки</summary>

![меню установки](../../de/install/media/proxmox/installationsmenü.png)

</детали>

Следующим шагом является согласие с условиями использования (EULA).

<details><summary>сова</summary>

![сова](../../de/install/media/proxmox/eula.png)

</детали>

Следующим шагом является выбор жесткого диска, на который будет установлен Proxmox. Если на сервере установлено несколько жестких дисков, убедитесь, что выбрали правильный жесткий диск!

<details><summary>Выбор жесткого диска</summary>

![выбор диска](../../de/install/media/proxmox/festplattenauswahl.png)

</детали>

С помощью **Опций кнопки** вы также можете указать другие параметры для установочного жесткого диска:

<details><summary>Дополнительные параметры жесткого диска</summary>

![параметры жесткого диска](../../de/install/media/proxmox/harddisk-options.png)

</детали>

Proxmox использует [Диспетчер логических томов](https://de.wikipedia.org/wiki/Logical_Volume_Manager) (LVM). Благодаря расширенным параметрам на этом этапе LVM можно, среди прочего, детально настроить.
Инсталлятор создает группу томов (VG) с именем pve и дополнительные логические тома (LV) с именами root (здесь установлен сам Proxmox), data (хранилище, где хранятся виртуальные диски виртуальных машин) и swap (здесь хранится файл подкачки ).

<details><summary>В расширенных настройках здесь можно указать определенные параметры:</summary>

- Файловая система: Здесь вы можете выбрать файловую систему. По умолчанию здесь используется ext4, и в большинстве случаев это хороший выбор. Если в хост-системе доступно несколько жестких дисков (и много оперативной памяти), здесь имеет смысл вариант zfs с соответствующим уровнем RAID. В этом случае, однако, вы должны были принципиально иметь дело с ZFS.
- hdsize: Определяет общий размер жесткого диска, который должен использоваться для Proxmox. Здесь вы обычно выбираете полный размер жесткого диска, если только вы не хотите добавить больше разделов позже.
- swapsize: определяет размер тома подкачки. Стандартный здесь тот же объем, что и у встроенной памяти, но минимум 4 Гб и максимум 8 Гб.
- maxroot: Задает максимальный размер корневого тома (сам Proxmox). **Следует отметить, что при базовой установке здесь также хранятся требуемые позже шаблоны и ISO-образы.**
- minfree: свободное место в группе томов LVM pve. Если диск больше 128 Гб, по умолчанию здесь остается свободным 16 Гб (LVM всегда нужно немного свободного места для создания снапшотов).
- maxvz: указывает максимальный размер тома данных.

</детали>

Обычно вы можете оставить все параметры по умолчанию (т.е. здесь ничего не указано). Они уже оптимально настроены для большинства установок.

После выбора жесткого диска для Proxmox запрашиваются параметры локализации (страна, время и соответствующая раскладка клавиатуры):

<details><summary>локализация</summary>

![расположение](../../de/install/media/proxmox/location.png)

</детали>

Затем вводится пароль пользователя root. Здесь также запрашивается адрес электронной почты. Это используется для отправки электронной почты на указанный здесь адрес в случае важных системных сообщений. Однако это не обязательно должен быть реальный адрес электронной почты (тогда, как администратор, вы больше не будете получать уведомления о важных системных событиях по электронной почте).

<details><summary>пароль и электронная почта</summary>

![пароль](../../de/install/media/proxmox/password.png)

</детали>

Следующий шаг установщика связан с сетевыми настройками. Здесь необходимо ввести статический IP-адрес (без DHCP). Это включает в себя сам IP-адрес (в нотации CIDR), IP-адрес шлюза (обычно IP-адрес маршрутизатора) и DNS-сервер, который будет использоваться (в частной среде обычно также IP-адрес маршрутизатора). Proxmox обычно определяет сеть автоматически.

<details><summary>сеть</summary>

![сеть](../../de/install/media/proxmox/network.png)

</детали>

В конце отобразится сводка по установке:

<details><summary>Краткое содержание</summary>

![краткое содержание](../../de/install/media/proxmox/zusammenfassung.png)

</детали>

Чтобы установить систему, проверьте настройки и нажмите «Установить».

<details><summary>монтаж</summary>

![монтаж](../../de/install/media/proxmox/installation.png)

</детали>

После небольшого ожидания установка завершена, и систему необходимо перезагрузить (предварительно извлеките флешку с ISO-образом).

Затем вы видите терминал. Здесь уже отображаются инструкции о том, как теперь можно получить доступ к системе:

<details><summary>консоль</summary>

![консоль](../../de/install/media/proxmox/konsole.png)

</детали>

Теперь он продолжается в браузере (пример https://10.1.1.89:8006). Однако сначала отображается предупреждение. Это связано с тем, что при установке был сгенерирован самоподписанный сертификат, о котором, конечно же, не знает браузер. Вы можете смело игнорировать это сообщение в этот момент — соединение в любом случае шифруется через HTTPS. Само сообщение зависит от браузера. В этом примере нажмите **Дополнительно**, а затем нажмите **Продолжить до 10.1.1.89 (небезопасно)**.

<details><summary>ошибка конфиденциальности</summary>

![ошибка конфиденциальности](../../de/install/media/proxmox/datenschutzfehler.png)

</детали>

Затем выполняется вход в систему с пользователем root и паролем, выбранным во время установки. Вы можете переключить язык на немецкий **сначала**, в противном случае интерфейс Proxmox будет отображаться на английском языке, и вам не придется вводить имя пользователя и пароль второй раз.

<details><summary>Постановка на учет</summary>

![Регистрация](../../de/install/media/proxmox/anmeldung.png)

</детали>

Сразу после этого входа вас встретит сообщение о том, что у вас нет действующей подписки на этот сервер. Это сообщение сначала подтверждается нажатием на OK.

<details><summary>подписка</summary>

![подписка](../../de/install/media/proxmox/subskription.png)

</детали>

Теперь исходники пакетов Proxmox должны быть скорректированы, чтобы можно было получать обновления.

<details><summary>исходники пакетов</summary>

![исходники пакетов](../../de/install/media/proxmox/paketquellen.png)

</детали>

Для этого к источникам пакетов добавляется **репозиторий без подписки**. Это можно сделать в меню экземпляра Proxmox в разделе `Updates > Repositories`. Репозиторий без подписки можно добавить с помощью кнопки «Добавить»:

<details><summary>Без подписки</summary>

![без подписки](../../de/install/media/proxmox/no-subscription.png)

</детали>

Теперь **Корпоративный репозиторий** должен быть деактивирован. Для этого просто выберите репозиторий pve-enterprise в представлении репозитория и нажмите кнопку **Деактивировать**.

Тогда конфигурация репозиториев выглядит так:

<details><summary>Корпоративный репозиторий</summary>

![предприятие](../../de/install/media/proxmox/enterprise.png)

</детали>

### Обновления
После изменения источников пакета необходимо выполнить первое обновление системы. Лучше всего это сделать через веб-интерфейс:

<details><summary>обновления</summary>

![обновления](../../de/install/media/proxmox/updates.png)

</детали>

Просто выберите нужный узел Proxmox (например, «pve»), а затем нажмите **Обновить** в разделе «Обновления». Здесь открывается так называемое средство просмотра задач, которое всегда отображается, когда в системе выполняются какие-либо действия. Теперь средство просмотра задач можно снова закрыть. Кстати, когда отображается средство просмотра задач, вам не нужно ждать, пока задача будет завершена («ЗАДАЧА ОК»), но этот диалог всегда можно снова закрыть напрямую — сама задача продолжает работать в фоновом режиме.
Если обновления уже доступны, их можно импортировать, нажав **Обновить**.

Здесь открывается веб-консоль, и вы можете следить за ходом выполнения.

<details><summary>веб-консоль</summary>

![веб-консоль](../../de/install/media/proxmox/web-konsole.png)

</детали>

Конечно, также возможно обновить сервер Proxmox через командную строку (например, через SSH):

~~~ apt update && apt dist-upgrade ~~~

Здесь важно только то, что вы используете **apt dist-upgrade** (на «обычных» машинах с Debian/Ubuntu вы, как правило, используете apt upgrade). Тем не менее, «обновление дистрибутива» важно для Proxmox, поскольку зависимости, необходимые для работы Proxmox, здесь разрешаются лучше.

В этом отношении базовая конфигурация Proxmox теперь завершена. Если вы хотите более подробно разобраться с Proxmox, стоит взглянуть на [Proxmox Wiki](https://pve.proxmox.com/wiki/Main_Page) или на [официальный форум](https://forum.proxmox.com/).

---

## Proxmox - Создание виртуальной Qemu/KVM машины (ВМ) + последующая установка ioBroker
В этом примере руководства показано, как создать [ВМ](https://pve.proxmox.com/wiki/Qemu/KVM_Virtual_Machines) (debian11), а затем установить в него ioBroker.

Конечно, можно использовать Ubuntu вместо Debian, но обязательно используйте сервер Ubuntu **LTS Version**.

Для ясности описания изображений и дополнительную информацию можно открыть.

### 1 - Скачать образ ISO
Во-первых, требуется [ISO-образ](https://www.debian.org/distrib/)(64-разрядный ПК Netinst-ISO), который необходимо загрузить в корневой каталог (локальный) при базовой установке (если не были созданы другие диски).

Для этого перейдите в локальные > ISO-образы. Там есть два варианта.

- ISO, ранее хранившийся на компьютере, можно загрузить на хост Proxmox с помощью кнопки **Загрузить**.
- **Загрузить с URL** можно загрузить ISO напрямую на хост через URL. Для этого скопируйте адрес ссылки 64-битного ПК Netinst-ISO (правая кнопка мыши), вставьте URL-адрес и нажмите **Query URL**, чтобы получить его. После последнего нажатия на **Загрузить** ISO-образ загружается напрямую.

<details><summary>Скачать ISO</summary>

![вм-изо](../../de/install/media/proxmox/vm-iso.png)

![vm-isourl](../../de/install/media/proxmox/vm-isourl.png)

</детали>

### 2 - Создать виртуальную машину
При нажатии на синюю кнопку **Создать ВМ** открывается окно, в котором необходимо выполнить следующие настройки.

- Общее: присвоение имени хоста и пароля, указан ID (начинается со 100), можно изменить, но не позже.
- ОС: выбор хранилища (локальное) и образ ISO (debian-11-netinst.iso)
- Система: все остается в настройках по умолчанию, **проверьте Qemu Agent**
- Диски: Хранилище local-lvm, размер диска 10 ГБ (10-20 ГБ должно быть достаточно, позже возможна замена, но здесь это не описано).
- ЦП: Зависит от мощности компьютера (также можно настроить в любой момент, для этого необходимо перезапустить ВМ)
- Память: размер оперативной памяти в МиБ (также можно изменить в любое время, для этого необходимо перезапустить виртуальную машину)
- Сеть: vmbr0, все остальное остается по умолчанию
- Подтвердить: здесь вы снова можете увидеть сводку (отметьте **Начать после создания**), а затем нажмите **Готово**, чтобы создать виртуальную машину.

<details><summary>Серия изображений Создать виртуальную машину</summary>

![vm-генерал](../../de/install/media/proxmox/vm-allgemein.png)

![вм-ос](../../de/install/media/proxmox/vm-os.png)

![вм система](../../de/install/media/proxmox/vm-system.png)

![vm-диски](../../de/install/media/proxmox/vm-disks.png)

![вм процессор](../../de/install/media/proxmox/vm-cpu.png)

![хранилище виртуальных машин](../../de/install/media/proxmox/vm-speicher.png)

![виртуальная сеть](../../de/install/media/proxmox/vm-netzwerk.png)

![vm-подтвердить](../../de/install/media/proxmox/vm-bestätigen.png)

</детали>

### 3 - Установка Debian
После запуска ВМ перейдите в консоль ВМ и запустите **Установить**.

<details><summary>консоль</summary>

![вм-установить](../../de/install/media/proxmox/vm-install.png)

</детали>

Вам будут предоставлены инструкции по установке, и во время этого процесса вам нужно будет выполнить некоторые настройки. Чтобы использовать его, вам нужны клавиши Tab, пробел и клавиши со стрелками. Из-за масштаба можно найти различные кадры серии изображений.

<span style="color:red">**ОПАСНОСТЬ! - Нельзя назначать пароль root.**</span>

Уведомление:

Не выбирайте **iobroker** в качестве имени пользователя, поскольку оно уже используется внутри компании.

<details><summary>Серия изображений Установка Debian</summary>

![вм-1](../../de/install/media/proxmox/vm-1.png)

![вм-2](../../de/install/media/proxmox/vm-2.png)

![вм-3](../../de/install/media/proxmox/vm-3.png)

![вм-4](../../de/install/media/proxmox/vm-4.png)

![вм-5](../../de/install/media/proxmox/vm-5.png)

![вм-6](../../de/install/media/proxmox/vm-6.png)

![вм-7](../../de/install/media/proxmox/vm-7.png)

![вм-8](../../de/install/media/proxmox/vm-8.png)

![вм-9](../../de/install/media/proxmox/vm-9.png)

![вм-10](../../de/install/media/proxmox/vm-10.png)

![вм-11](../../de/install/media/proxmox/vm-11.png)

![вм-12](../../de/install/media/proxmox/vm-12.png)

![вм-13](../../de/install/media/proxmox/vm-13.png)

![вм-14](../../de/install/media/proxmox/vm-14.png)

![вм-15](../../de/install/media/proxmox/vm-15.png)

![вм-16](../../de/install/media/proxmox/vm-16.png)

![вм-17](../../de/install/media/proxmox/vm-17.png)

![вм-18](../../de/install/media/proxmox/vm-18.png)

![вм-19](../../de/install/media/proxmox/vm-19.png)

![вм-20](../../de/install/media/proxmox/vm-20.png)

![вм-21](../../de/install/media/proxmox/vm-21.png)

![вм-22](../../de/install/media/proxmox/vm-22.png)

![вм-23](../../de/install/media/proxmox/vm-23.png)

![вм-24](../../de/install/media/proxmox/vm-24.png)

![вм-25](../../de/install/media/proxmox/vm-25.png)

![вм-26](../../de/install/media/proxmox/vm-26.png)

</детали>

### 4 - Настройка виртуальной машины
Перезапустите виртуальную машину, затем войдите в систему с «Именем пользователя» и «Паролем», назначенными при установке. Затем с помощью команды

~~~ IP-адрес ~~~

нашел IP-адрес. Это необходимо для удаленного подключения к ВМ по ssh, как на следующем шаге.

<details><summary>IP-адрес</summary>

![vm-ipaddr](../../de/install/media/proxmox/vm-ipaddr.png)

</детали>

Теперь к виртуальной машине можно получить доступ через ssh (например, Putty). Здесь вы снова входите в систему с «именем пользователя» и «паролем».
Затем сетевой адрес можно изменить с **dhcp** на **static**. (что рекомендуется для работы сервера)

~~~ sudo nano /etc/network/interfaces ~~~

<details><summary>сеть/интерфейсы</summary>

![вм-нано](../../de/install/media/proxmox/vm-nano.png)

![vm-dhcp](../../de/install/media/proxmox/vm-dhcp.png)

![вм-статический](../../de/install/media/proxmox/vm-statisch.png)

</детали>

Изменения в редакторе сохраняются комбинацией клавиш CTRL+o, далее ENTER, CTRL+x выход из редактора.

Изменения IP-адреса вступают в силу только после перезапуска виртуальной машины. Однако перед этим проверяется, активен ли гостевой агент Qemu с помощью

~~~ статус sudo systemctl qemu-guest-agent ~~~

<details><summary>Гостевой агент</summary>

![vm-qemugest](../../de/install/media/proxmox/vm-qemuguest.png)

</детали>

<span style="color:orange">**ОПАСНОСТЬ! - Для установки Ubuntu необходимо установить и запустить гостевой агент Qemu..**</span>

Команды для этого:

~~~ sudo apt-get install qemu-guest-agent sudo systemctl start qemu-guest-agent ~~~

Кроме того, чтобы иметь возможность установить iobroker, после этого необходимо установить **curl**.
~~~ sudo apt установить curl ~~~

<details><summary>переустановить завиток</summary>

![вм завиток](../../de/install/media/proxmox/vm-curl.png)

</детали>

Чтобы передать устройства (USB) в виртуальной машине, выберите ВМ > Оборудование > Добавить > USB-устройства > Идентификатор поставщика/устройства. Здесь перечислены все подключенные устройства.

<details><summary>USB-устройства</summary>

![vm-usb](../../de/install/media/proxmox/vm-usb.png)

</детали>

Чтобы ВМ запускалась автоматически после перезагрузки компьютера (Proxmox), это нужно активировать в опциях ВМ.

<details><summary>вариант загрузки</summary>

![vm-загрузка](../../de/install/media/proxmox/vm-booten.png)

</детали>

На этом установка и настройка виртуальной машины завершена. Теперь виртуальную машину можно перезапустить, а затем установить ioBroker.

---

## Proxmox - Создание контейнера Linux (LXC) + последующая установка ioBroker
В этом примере руководства показано, как создать [Контейнеры LXC](https://pve.proxmox.com/wiki/Linux_Container) (debian11), а затем установить в него ioBroker.

Для ясности описания изображений и дополнительную информацию можно открыть.

### 1 - Скачать шаблон контейнера
Во-первых, требуется шаблон, который необходимо загрузить в корневую директорию (локальную) при базовой установке (если не были созданы другие диски).

Для этого перейдите в локальные > Шаблоны контейнеров. При нажатии на **Шаблоны** открывается список выбора. Здесь вы выбираете стандарт debian-11 (яблочко) и нажимаете «Загрузить».

<details><summary>Скачать шаблон</summary>

![местный](../../de/install/media/proxmox/local.png)

![шаблоны](../../de/install/media/proxmox/templates.png)

![загрузка шаблона](../../de/install/media/proxmox/template-laden.png)

</детали>

### 2 - Создать LXC
При нажатии на синюю кнопку **Создать CT** открывается окно, в котором теперь необходимо выполнить следующие настройки.

- Общее: Назначение имени хоста и пароля, указан идентификатор (начинается со 100), но его можно изменить.
- Шаблон: выбор хранилища (локальный) и шаблон (стандарт debian-11)
- Диски: Назначение размера диска (не будьте слишком щедры, вы можете увеличить его в любой момент)
- Процессор: зависит от мощности компьютера (также можно настроить в любое время)
- Память: назначение Ram/Swap (можно настроить в любое время, даже во время работы)
- Сеть: назначение статического IP/CIDR, шлюз, если IPv6 не настроен, устанавливается SLAAC.
- DNS: обычно ничего не меняется (используются значения с хоста)
- Подтвердите: сводка (отметьте **Начать после создания**), затем нажмите **Готово**, чтобы создать контейнер.

<details><summary>Серия изображений Создать КТ</summary>

![пве](../../de/install/media/proxmox/pve.png)

![lxc-общий](../../de/install/media/proxmox/lxc-allgemein.png)

![lxc-шаблон](../../de/install/media/proxmox/lxc-template.png)

![lxc диски](../../de/install/media/proxmox/lxc-disks.png)

![lxc процессор](../../de/install/media/proxmox/lxc-cpu.png)

![LXC память](../../de/install/media/proxmox/lxc-speicher.png)

![сеть lxc](../../de/install/media/proxmox/lxc-netzwerk.png)

![lxc-dns](../../de/install/media/proxmox/lxc-dns.png)

![lxc-подтвердить](../../de/install/media/proxmox/lxc-bestätigen.png)

![lxc-просмотрщик задач](../../de/install/media/proxmox/lxc-taskviewer.png)

</детали>

### 3 - Настройка LXC
Теперь, когда контейнер запущен, перейдите в консоль LXC.

<details><summary>консоль</summary>

![lxc консоль](../../de/install/media/proxmox/lxc-konsole.png)

</детали>

Здесь вы сначала входите в систему как root с ранее назначенным паролем, который был назначен при создании LXC, и сначала обновляете его.

~~~ подходящее обновление && подходящее обновление ~~~

<details><summary>обновление</summary>

![lxc обновление](../../de/install/media/proxmox/lxc-upgrade.png)

</детали>

Прямо указано, что часовой пояс еще нужно установить.

~~~ dpkg-reconfigure tzdata ~~~

<details><summary>часовой пояс</summary>

![lxc-tzdata](../../de/install/media/proxmox/lxc-tzdata.png)

![лкск область](../../de/install/media/proxmox/lxc-area.png)

![lxc-часовой пояс](../../de/install/media/proxmox/lxc-timezone.png)

</детали>

Теперь будут установлены **sudo** и **curl**. Sudo требуется, как и на следующем шаге, для корректного создания пользователя, который будет использоваться в дальнейшем для работы на консоли. Curl необходим для вызова скрипта установки ioBroker на последнем шаге.

~~~ подходящая установка sudo curl ~~~

<details><summary>переустановить</summary>

![lxc-судо](../../de/install/media/proxmox/lxc-sudo.png)

</детали>

Теперь создайте будущего пользователя. Замените «имя пользователя» в этом случае. Назначение пароля пользователю. Остальное можно подтвердить клавишей ENTER.

Уведомление:

Не выбирайте **iobroker** в качестве имени пользователя, поскольку оно уже используется внутри компании.

~~~ имя пользователя adduser ~~~

Затем пользователь должен быть назначен в группу sudo.

~~~ usermod -aG имя пользователя sudo ~~~

<details><summary>Создать пользователей</summary>

![lxc-adduser](../../de/install/media/proxmox/lxc-adduser.png)

</детали>

На последнем этапе перед установкой ioBroker выйдите из системы один раз.

~~~ выход ~~~

а затем войдите в систему с новым пользователем. Теперь можно установить iobroker.

<details><summary>выйдите из системы и войдите как пользователь</summary>

![логин пользователя lxc](../../de/install/media/proxmox/lxc-useranmeldung.png)

</детали>

Чтобы LXC запускался автоматически после перезагрузки компьютера (Proxmox), это нужно активировать в опциях контейнера.

<details><summary>вариант загрузки</summary>

![lxc загрузки](../../de/install/media/proxmox/lxc-booten.png)

</детали>

---

## Установить ioBroker
Все, что вам нужно для установки ioBroker, — это одна команда.

~~~ curl -sLf https://iobroker.net/install.sh | Баш-~~~

Шаги установки разделены на 4 шага, которые выполняются полностью автоматически.

- Установка необходимых компонентов (1/4)
- Создание пользователя и каталога ioBroker (2/4)
- Установка ioBroker (3/4)
- Завершение установки (4/4)

<details><summary>установщики</summary>

![установщик iobroker](../../de/install/media/proxmox/iobroker-installer.png)

![iobroker-installer1](../../de/install/media/proxmox/iobroker-installer1.png)

![iobroker-installer2](../../de/install/media/proxmox/iobroker-installer2.png)

![iobroker-установщик3](../../de/install/media/proxmox/iobroker-installer3.png)

</детали>

Установка успешно завершена, когда в конце появится следующее.

~~~ ioBroker успешно установлен Откройте http://10.1.1.222:8081 в браузере и приступайте к настройке! ~~~

В то же время это также означает, что ioBroker теперь можно вызывать в браузере по адресу. Если все заработало без проблем, вас встретит установка ioBroker. Теперь осталось всего несколько шагов, которые вы проведете вместе с помощником.

<details><summary>Серия изображений ioBroker Assistant</summary>

![настройка iobroker](../../de/install/media/proxmox/iobroker-setup.png)

![iobroker-setup1](../../de/install/media/proxmox/iobroker-setup1.png)

![iobroker-setup2](../../de/install/media/proxmox/iobroker-setup2.png)

![iobroker-setup3](../../de/install/media/proxmox/iobroker-setup3.png)

![iobroker-setup4](../../de/install/media/proxmox/iobroker-setup4.png)

![iobroker-setup5](../../de/install/media/proxmox/iobroker-setup5.png)

![iobroker-setup6](../../de/install/media/proxmox/iobroker-setup6.png)

</детали>

Затем вы можете искать устройства и службы. Необходимые адаптеры/экземпляры могут быть созданы автоматически.

<details><summary>Поиск устройства/службы серии изображений</summary>

![поиск устройства](../../de/install/media/proxmox/gerätesuche.png)

![экземпляры](../../de/install/media/proxmox/instanzen.png)

![iobroker-сделано](../../de/install/media/proxmox/iobroker-fertig.png)

</детали>

На этом установка ioBroker завершена. Дополнительные адаптеры могут быть установлены в любое время в зависимости от применения и желания.

---

## Proxmox - LXC (контейнеры Linux) -> Прохождение через USB-устройства
В этой части руководства шаг за шагом объясняется, как пройти через USB-устройство (переход через USB) в Proxmox в LXC (контейнер Linux).

С виртуальной машиной можно передать USB-устройство напрямую через веб-интерфейс Proxmox, а с контейнером Linux для этого в настоящее время необходимо редактировать файл конфигурации lxc вручную.

В инструкциях описывается, как интегрировать **Texas Instruments Inc. CC2531** Zigbee-модем, но те же шаги можно использовать аналогично для других Zigbee-модулей (ConBee, CC2652P и т. д.) или для других USB-устройств, за исключением сетевых USB-устройств. (Bluetooth/Wlan).

* Для этой части инструкций использовался Proxmox версии 7.1.

### 1.) Соберите информацию об устройстве USB
<details>

Установка SSH-соединения с Proxmox:

~~~ ssh root@ip адрес ~~~

<span style="color:red">**Если USB-устройство уже подключено к хосту Proxmox, отключите его на время.**</span>

Следующая команда выводит список всех подключенных в настоящее время USB-устройств на хосте Proxmox:

~~~ lsusb ~~~

![proxmoxlxc00](../../de/install/media/proxmox/proxmoxlxc00.PNG)

Теперь интегрируемое USB-устройство подключается к хосту Proxmox, и снова выполняется команда lsusb.

![proxmoxlxc01](../../de/install/media/proxmox/proxmoxlxc01.PNG)

На скриншоте видно, что новое устройство с номером шины USB: **001** и номером устройства: **003** указано.

Эта информация необходима для использования следующей команды, например. выведите **старший номер устройства** из устройства:

~~~ ls -l /dev/bus/usb/001/003 ~~~

Важно использовать вывод номера шины USB и номера устройства с помощью команды!

***ls -l /dev/bus/usb/номер-usb-шины/номер-устройства***

![proxmoxlxc02](../../de/install/media/proxmox/proxmoxlxc02.PNG)

USB-устройство в этом примере имеет старший номер устройства **189**, запишите значение вашего устройства в текстовом файле с комментарием: #1

![proxmoxlxc03](../../de/install/media/proxmox/proxmoxlxc03.PNG)

Затем мы выводим уникальный идентификатор USB-устройства и записываем выходное значение в текстовый файл с пометкой: #2

~~~ ls /dev/serial/by-id/ ~~~

![proxmoxlxc04](../../de/install/media/proxmox/proxmoxlxc04.PNG)

![proxmoxlxc05](../../de/install/media/proxmox/proxmoxlxc05.PNG)

В качестве последнего шага выводится основной номер устройства ttyACM и отмечается примечанием: #3:

~~~ ls -l /dev/ttyACM* ~~~

![proxmoxlxc06](../../de/install/media/proxmox/proxmoxlxc06.PNG)

>*Если вывода нет, проверьте с помощью «ls -l /dev/serial/by-id/», интегрируется ли USB-устройство в систему как ttyUSB, если да, замените все следующие команды, которые ссылаются на **ttyACM. ..* * получить от **ttyUSB…** если нет вывода, это не устройство класса USB CDC (последовательная связь), поэтому все точки, которые нужно включить в ttyACM, можно игнорировать.*

Итак, мы записали **три** значения с USB-устройства, которые необходимы для интеграции в конфигурационный файл lxc.

![proxmoxlxc07](../../de/install/media/proxmox/proxmoxlxc07.PNG)

</детали>

### 2.) Отредактируйте файл конфигурации LXC
<details>

Перейдите в каталог конфигурации LXC на хосте Proxmox с помощью:

~~~ cd /etc/pve/lxc ~~~

Файл конфигурации имеет тот же идентификационный номер, который был присвоен при создании lxc!

![proxmoxlxc08](../../de/install/media/proxmox/proxmoxlxc08.PNG)

![proxmoxlxc09](../../de/install/media/proxmox/proxmoxlxc09.PNG)

Перед редактированием конфигурационного файла необходимо сделать резервную копию:

~~~ cp 201.conf 201.conf.backup ~~~

![proxmoxlxc10](../../de/install/media/proxmox/proxmoxlxc10.PNG)

Теперь файл конфигурации редактируется с помощью vi или nano:

~~~ нано 201.conf ~~~

![proxmoxlxc11](../../de/install/media/proxmox/proxmoxlxc11.PNG)

В конец конфигурационного файла добавляется следующее:

~~~ lxc.cgroup2.devices.allow: c 189:* rwm lxc.mount.entry: usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0012023529-if00 dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X001 24B0 012023529-if00 нет привязки, необязательно, создать = файл

lxc.cgroup2.devices.allow: c 166:* rwm lxc.mount.entry: /dev/ttyACM0 dev/ttyACM0 нет привязки, необязательный, создать=файл ~~~

Замените отмеченные значения на отмеченные записи из вашей заметки!

![12](../../de/install/media/proxmox/proxmoxlxc12.PNG)

* Первая строка относится к основному номеру устройства **189** Примечание: #1
* Во второй строке уникальный идентификатор (usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0012023529-if00) из Примечание: #2 дается индивидуально и с абсолютным путем, обратите внимание, что полный текст пишется в одну строку без переносов строк.
* В третьей строке указан основной номер устройства **166** от ttyACM из примечания №3.

Сохраните файл конфигурации (в редакторе nano комбинацией клавиш: CTRL+o & CTRL+x для выхода из редактора)

</br>

<span style="color:orange">**ОПАСНОСТЬ! – Если в вашем контейнере есть активные моментальные снимки:**</span>

<details>

Тогда код lxc.cgroup находится не в конце конфигурационного файла, а перед первой записью моментального снимка.

![proxmoxlxc18](../../de/install/media/proxmox/proxmoxlxc18.PNG)

</детали>

<span style="color:orange">**ОПАСНОСТЬ! - Установка Proxmox до версии 7.0:**</span>

<details>

Замените записи на

~~~ lxc.cgroup2 ~~~

через

~~~ lxc.cgroup ~~~

</детали>

</br> Наконец, введите следующую команду, чтобы установить необходимые права для ttyACM0:

~~~ chmod o+rw /dev/ttyACM* ~~~

Чтобы применить корректировки к lxc, выполните холодную перезагрузку из контейнера с **pct stop id/pct start id**:

~~~ пкт стоп 201 ~~~

~~~ пкт начало 201 ~~~

</br>

<span style="color:green">**Совет: лучше всего хранить копию вашего рабочего файла конфигурации извне, т.к. B. встроенный сервис резервного копирования Proxmox не создает резервную копию содержимого вашей конфигурации!**</span>

</br>

</детали>

### 3.) Проверьте сквозную передачу USB LXC и конфигурацию экземпляра Zigbee.
<details>

Установка SSH-соединения с LXC:

~~~ ssh user@ip адрес ~~~

С помощью команд:

~~~ lsusb ~~~

&

~~~ ls -l /dev ~~~

проверяется, были ли корректировки в файле конфигурации успешными.

![proxmoxlxc13](../../de/install/media/proxmox/proxmoxlxc13.PNG)

* Как видно на скриншоте, контейнер теперь имеет доступ к USB-устройству.

* Важно, что ttyACM0 имеет такие же права на скриншоте, т.е. **crw-rw-rw- 1 Nobody nogroup**

>***Если вы не проверите, все ли значения в конфигурационном файле установлены, как описано, права все равно не должны совпадать, тогда переходите к пункту 5.***

* На снимке экрана также видно, что номер устройства cc2531 изменился с 3 на 4, это связано с тем, что флешка в это время была отключена и снова подключена. Однако, поскольку в конфигурационном файле указан уникальный идентификатор, а не номер шины/устройства, сквозная передача через USB продолжает работать.

Если, как описано выше, в контейнер пропущена Zigbee-флешка, ее необходимо прописать в iobroker в настройках Zigbee-адаптера под именем COM-порта.

~~~ /dev/ttyACM0 ~~~

указывается таким образом, чтобы адаптер обращался к правильному устройству.

![proxmoxlxc14](../../de/install/media/proxmox/proxmoxlxc14.PNG)

</детали>

### 4.) Правило UDEV для постоянных прав Настройка ttyACM0
<details>

В конце шага 3 использовалась команда

~~~ chmod o+rw /dev/ttyACM* ~~~

соответствующие права установлены для ttyACM0, но изменения этих прав сбрасываются при перезапуске хоста Proxmox.На хосте Proxmox требуется правило udev для постоянной настройки.

С помощью lsusb мы снова выводим список подключенных в данный момент USB-устройств:

~~~ lsusb ~~~

![proxmoxlxc15](../../de/install/media/proxmox/proxmoxlxc15.PNG)

На этот раз мы записываем числовые значения после ID, поэтому в данном случае **0451:16a8**

* Первое значение: ***0451*** означает **idVendor**, а второе значение: ***16a8*** — **idProduct**.

Теперь правило udev создается в /etc/udev/rules.d с помощью vi или nano:

~~~ нано /etc/udev/rules.d/50-myusb.rules ~~~

и добавил следующий контент:

~~~ ПОДСИСТЕМЫ=="usb", ATTRS{idVendor}=="0451", ATTRS{idProduct}=="16a8", GROUP="users", MODE="0666" ~~~

![proxmoxlxc16](../../de/install/media/proxmox/proxmoxlxc16.PNG)

Наконец, выполните следующую команду, чтобы активировать правило udev:

~~~ udevadm control --reload ~~~

</детали>

### 5.) Устранение неполадок
<details>

**Ошибка:** права ttyACM0 в lxc не совпадают или теряются через короткое время (ConBee II).

~~~ ls -l /dev/ttyACM0 c--------- 0 Nobody nogroup 166, 0 7 февраля 14:29 ttyACM0 ~~~

</br>

**Решение.** Используйте mknod, чтобы создать постоянную привязку для контейнера.

Для этого создается папка **devices** по пути **"/var/lib/lxc/CONTAINERID"** и создается привязка в этой папке с помощью mknod:

~~~ mkdir /var/lib/lxc/201/devices ~~~

~~~ cd /var/lib/lxc/201/devices ~~~

~~~ mknod -m 666 ttyACM0 c 166 0 ~~~

+ *mknod создает файл с именем ttyACM0 в пути (пока файл существует, устройство привязано к lxc)*

![proxmoxlxc17](../../de/install/media/proxmox/proxmoxlxc17.PNG)

***основной номер устройства и ttyACM.. при необходимости отрегулируйте***

Затем необходимо изменить запись в файле конфигурации lxc:

~~~ lxc.mount.entry: /dev/ttyACM0 dev/ttyACM0 нет привязки, необязательный, создать=файл ~~~

будет заменен на:

~~~ lxc.mount.entry: /var/lib/lxc/CONTAINERID/devices/ttyACM0 dev/ttyACM0 нет привязки, необязательный, создать=файл ~~~

</детали>

---

## Настройка USB-накопителя/диска для резервного копирования
Чтобы будущие резервные копии можно было сохранять отдельно, существует возможность интеграции USB-устройства в виде флешки или диска на хосте Proxmox.
Для этого устройство должно иметь определенный формат.
Распространенными [файловые системы](https://wiki.ubuntuusers.de/Dateisystem/) являются **vFAT** или **NTFS**. Оба могут быть прочитаны Linux, Windows или MacOS.
Для чистого Linux обычно **EXT4**.

Если носитель данных все еще не разбит на разделы или вы хотите его переформатировать, вы можете сделать это на ПК с Windows (ntfs) или непосредственно на сервере Proxmox.
Когда носитель данных подготовлен, его можно смонтировать в системе, а затем добавить напрямую в качестве хранилища (каталога) через графический интерфейс Proxmox.

<span style="color:orange">**ОПАСНОСТЬ! - При новом форматировании все предыдущие данные на носителе будут удалены</span>

Следующие примеры инструкций относятся к настройке непосредственно на хосте Proxmox. Также можно использовать ssh/putty.

**Обратите внимание, что для следующих команд требуется root, при использовании пользовательского пользователя на хосте команды ниже должны иметь префикс sudo.**

### Подготовить устройство
### 1 - Идентифицировать устройство
Сначала вы найдете устройство с [лсблк](https://wiki.ubuntuusers.de/lsblk/). Рекомендуется выполнить команду один раз до и после ее подключения. Это упрощает идентификацию устройства.

~~~ лсблк ~~~

выглядит примерно так (буквы различаются в зависимости от количества подключенных устройств)

~~~ sdd 8:48 0 119.2G 0 disk ├─sdd1 8:49 0 119.2G 0 часть └─sdd9 8:57 0 8M 0 часть sde 8:64 0 931.5G 0 disk <-- Это диск / dev/sde └─sde1 8:65 0 931.5G 0 часть <-- Это первый раздел /dev/sde1, если он уже отформатирован sr0 11:0 1 1024M 0 rom sr1 11:1 1 1024M 0 rom ~~~

### 2 - Разделение
Диск разбит на разделы с помощью меню [cfdisk](https://wiki.ubuntuusers.de/fdisk/)

~~~ cfdisk /dev/sde ~~~

### 3 - Создать файловую систему
Теперь необходимо отформатировать ранее созданный раздел. Как упоминалось выше, существуют разные варианты, в зависимости от предполагаемого использования.
Раздел форматируется командой [mkfs](https://wiki.ubuntuusers.de/Formatieren/) и соответствующими параметрами.

~~~ mkfs.vfat /dev/sde1 ~~~

### 4 - Смонтировать диск
Чтобы иметь возможность использовать заполненный носитель данных, он должен быть [смонтированный](https://wiki.ubuntuusers.de/mount/).

Для этого создается подходящая точка монтирования, а чтобы носитель данных снова автоматически интегрировался после перезагрузки, вам также потребуется соответствующая запись в [/etc/fstab](https://wiki.ubuntuusers.de/fstab/).

Для этого необходимо считать уникальный **UUID** накопителя.

Создать точку монтирования ~~~ mkdir /media/ext_usb ~~~

Смонтировать носитель ~~~ смонтировать /dev/sde1 /media/ext_usb ~~~

Получить UUID ~~~ blkid | grep -i sde ~~~ дает ~~~ /dev/sde1: LABEL="Export_Images" UUID="136b058d-f0c8-406d-a82b-2adcc00b72bf" UUID_SUB="951e8519-8478-4d64-b093-c3597147f989" BLOCK_SIZE=" 4096" ТИП="btrfs" PARTUUID="00011a10-01" ~~~

Отредактируйте запись в */etc/fstab* с помощью nano ~~~ nano /etc/fstab ~~~ теперь эта запись добавляется, а затем сохраняется ~~~ UUID="136b058d-f0c8-406d-a82b-2adcc00b72bf" /media/ ext_usb vfat по умолчанию 0 0 ~~~

### 5- Добавить хранилище в Proxmox
Каталог теперь можно добавить в разделе Data Center>Storage. Обозначение ID можно выбрать произвольно, например *usb-backup*.

Путь указан в столбце *Directory*, в данном случае */media/ext_usb*.

С *Content* вам нужно только выбрать нужный запрос.