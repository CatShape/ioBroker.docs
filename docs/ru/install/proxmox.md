---
title: Проксмокс
Version: 0.1
Autoren: TeNNo2k5
Schlüsselworte: Proxmox, LXC, USB Passthrough
lastChanged: 15.02.2022
translatedFrom: de
translatedWarning: Если вы хотите отредактировать этот документ, удалите поле «translationFrom», в противном случае этот документ будет снова автоматически переведен
editLink: https://github.com/ioBroker/ioBroker.docs/edit/master/docs/ru/install/proxmox.md
hash: f59N5O3KKS/hmr7FJUOBYHgDkpmBM0bWd08IDuHTqHE=
---
# Проксмокс
![логотип proxmox](../../de/install/media/proxmox/Proxmox-logo-860.png)

## Установка проксмокса
Proxmox Virtual Environment (сокращенно Proxmox VE) — это платформа виртуализации на базе Debian. Технология виртуализации в Proxmox основана на QEMU/KVM.

Proxmox «упаковывает» QEMU/KVM в собственный веб-интерфейс и, таким образом, упрощает администрирование (а также поддерживает контейнеры Linux — LXC). Это делает Proxmox, с одной стороны, удобным для начинающих, а с другой стороны, настолько мощным, что его можно использовать и в профессиональной среде.

В этом разделе показан пример установки и базовой настройки Proxmox в бесплатной версии (без подписки).

Для ясности описания изображений и дополнительную информацию можно открыть.

### Требования
<details><summary>требования</summary>

- 64-битный процессор
- ЦП и материнская плата должны поддерживать Intel VT/AMD-V для виртуализации и быть активированы в BIOS.
- 1 ГБ оперативной памяти (только для Proxmox) - в зависимости от количества виртуальных машин, которые будут работать, здесь, конечно, требуется больше оперативной памяти. Поэтому рекомендуется минимум 8 ГБ, а еще лучше 16 ГБ оперативной памяти.

</детали>

### Создать ISO-образ/загрузочную флешку
Сначала вам понадобится образ ISO, который можно загрузить с [Страница загрузки Proxmox](https://www.proxmox.com/de/downloads/category/iso-images-pve).

<details><summary>Проксмокс Изо</summary>

![proxmox-iso](../../de/install/media/proxmox/proxmox-iso)

</детали>

Для установки необходимо создать загрузочную флешку с этим ISO-образом. Это должно иметь по крайней мере 2 ГБ памяти. Существует несколько способов создания загрузочной флешки, см. [Подготовьте установочный носитель](https://pve.proxmox.com/wiki/Prepare_Installation_Media#_instructions_for_windows)

### Установка
Система должна быть настроена в UEFI/BIOS, чтобы ее можно было запустить с USB-устройства. После вставки USB-накопителя через короткое время появится меню установки Proxmox (если нет, вы также можете указать USB-накопитель в качестве загрузочного носителя вручную (на большинстве материнских плат это можно сделать с помощью F8 или F11).

**Установить Proxmox VE** теперь можно просто выбрать в меню установки.

<details><summary>Меню установки</summary>

![меню установки](../../de/install/media/proxmox/installationsmenü)

</детали>

Следующим шагом является согласие с условиями использования (EULA).

<details><summary>сова</summary>

![сова](../../de/install/media/proxmox/eula)

</детали>

Следующим шагом является выбор жесткого диска, на который будет установлен Proxmox. Если на сервере установлено несколько жестких дисков, убедитесь, что выбрали правильный жесткий диск!

<details><summary>Выбор жесткого диска</summary>

![выбор диска](../../de/install/media/proxmox/festplattenauswahl)

</детали>

С помощью **Опций кнопки** вы также можете указать другие параметры для установочного жесткого диска:

<details><summary>Дополнительные параметры жесткого диска</summary>

![параметры жесткого диска](../../de/install/media/proxmox/harddisk-options)

</детали>

Proxmox использует [Диспетчер логических томов](https://de.wikipedia.org/wiki/Logical_Volume_Manager) (LVM). Благодаря расширенным параметрам на этом этапе LVM можно, среди прочего, детально настроить.
Инсталлятор создает группу томов (VG) с именем pve и дополнительные логические тома (LV) с именами root (здесь устанавливается сам Proxmox), data (хранилище, где хранятся виртуальные диски виртуальных машин) и swap (здесь хранится файл подкачки ).

<details><summary>В расширенных настройках здесь можно указать определенные параметры:</summary>

- Файловая система: Здесь вы можете выбрать файловую систему. По умолчанию здесь используется ext4, и в большинстве случаев это хороший выбор. Если в хост-системе доступно несколько жестких дисков (и много оперативной памяти), здесь имеет смысл использовать вариант zfs с соответствующим уровнем RAID. В этом случае, однако, вы должны были принципиально иметь дело с ZFS.
- hdsize: Определяет общий размер жесткого диска, который должен использоваться для Proxmox. Здесь вы обычно выбираете полный размер жесткого диска, если только вы не хотите добавить больше разделов позже.
- swapsize: определяет размер тома подкачки. Стандартный здесь тот же объем, что и у встроенной памяти, но минимум 4 Гб и максимум 8 Гб.
- maxroot: Задает максимальный размер корневого тома (сам Proxmox). **Следует отметить, что при базовой установке здесь также хранятся требуемые позже шаблоны и ISO-образы.**
- minfree: свободное место в группе томов LVM pve. Если диск больше 128 ГБ, по умолчанию здесь остается свободным 16 ГБ (LVM всегда нужно немного свободного места для создания снапшотов).
- maxvz: указывает максимальный размер тома данных.

</детали>

Обычно вы можете оставить все параметры по умолчанию (т.е. здесь ничего не указано). Они уже оптимально настроены для большинства установок.

После выбора жесткого диска для Proxmox запрашиваются параметры локализации (страна, время и соответствующая раскладка клавиатуры):

<details><summary>локализация</summary>

![место нахождения](../../de/install/media/proxmox/location)

</детали>

Затем вводится пароль пользователя root. Здесь также запрашивается адрес электронной почты. Это используется для отправки электронной почты на указанный здесь адрес в случае важных системных сообщений. Однако это не обязательно должен быть реальный адрес электронной почты (тогда, как администратор, вы больше не будете получать уведомления о важных системных событиях по электронной почте).

<details><summary>пароль и электронная почта</summary>

![пароль](../../de/install/media/proxmox/password)

</детали>

Следующий шаг установщика связан с сетевыми настройками. Здесь необходимо ввести статический IP-адрес (без DHCP). Это включает в себя сам IP-адрес (в нотации CIDR), IP-адрес шлюза (обычно IP-адрес маршрутизатора) и DNS-сервер, который будет использоваться (в частной среде обычно также IP-адрес маршрутизатора). Proxmox обычно определяет сеть автоматически.

<details><summary>сеть</summary>

![сеть](../../de/install/media/proxmox/network)

</детали>

В конце отобразится сводка по установке:

<details><summary>Резюме</summary>

![Резюме](../../de/install/media/proxmox/zusammenfassung)

</детали>

Чтобы установить систему, проверьте настройки и нажмите «Установить».

<details><summary>установка</summary>

![установка](../../de/install/media/proxmox/installation)

</детали>

После небольшого ожидания установка завершена, и систему необходимо перезагрузить (предварительно извлеките флешку с ISO-образом).

Затем вы видите терминал. Здесь уже отображаются инструкции о том, как теперь можно получить доступ к системе:

<details><summary>приставка</summary>

![приставка](../../de/install/media/proxmox/konsole)

</детали>

Теперь продолжите в браузере (пример https://10.1.1.89:8006). Однако сначала отображается предупреждение. Это связано с тем, что при установке был сгенерирован самоподписанный сертификат, о котором, конечно же, не знает браузер. Вы можете смело игнорировать это сообщение в этот момент — соединение в любом случае шифруется через HTTPS. Само сообщение зависит от браузера. В этом примере нажмите **Дополнительно**, а затем нажмите **Продолжить до 10.1.1.89 (небезопасно)**.

<details><summary>ошибка конфиденциальности</summary>

![ошибка конфиденциальности](../../de/install/media/proxmox/datenschutzfehler)

</детали>

Затем выполняется вход в систему с пользователем root и паролем, выбранным во время установки. Вы можете переключить язык на немецкий **сначала**, в противном случае интерфейс Proxmox будет отображаться на английском языке, и вам не придется вводить имя пользователя и пароль второй раз.

<details><summary>Зарегистрироваться</summary>

![Зарегистрироваться](../../de/install/media/proxmox/anmeldung)

</детали>

Сразу после этого входа вас встретит сообщение о том, что у вас нет действующей подписки на этот сервер. Это сообщение сначала подтверждается нажатием на OK.

<details><summary>подписка</summary>

![подписка](../../de/install/media/proxmox/subskription)

</детали>

Теперь исходники пакетов Proxmox должны быть скорректированы, чтобы можно было получать обновления.

<details><summary>исходники пакетов</summary>

![исходники пакетов](../../de/install/media/proxmox/paketquellen)

</детали>

Для этого к источникам пакетов добавляется **репозиторий без подписки**. Это можно сделать в меню экземпляра Proxmox в разделе `Updates > Repositories`. Репозиторий без подписки можно добавить с помощью кнопки «Добавить»:

<details><summary>Без подписки</summary>

![без подписки](../../de/install/media/proxmox/no-subscription)

</детали>

Теперь **Корпоративный репозиторий** должен быть деактивирован. Для этого просто выберите репозиторий pve-enterprise в представлении репозитория и нажмите кнопку **Деактивировать**.

Тогда конфигурация репозиториев выглядит так:

<details><summary>Корпоративный репозиторий</summary>

![предприятие](../../de/install/media/proxmox/enterprise)

</детали>

### Обновления
После изменения источников пакета необходимо выполнить первое обновление системы. Лучше всего это сделать через веб-интерфейс:

<details><summary>обновления</summary>

![обновления](../../de/install/media/proxmox/updates)

</детали>

Просто выберите нужный узел Proxmox (например, «pve»), а затем нажмите **Обновить** в разделе «Обновления». Здесь открывается так называемое средство просмотра задач, которое всегда отображается, когда в системе выполняются какие-либо действия. Теперь средство просмотра задач можно снова закрыть. Кстати, когда отображается средство просмотра задач, вам не нужно ждать, пока задача будет завершена («ЗАДАЧА ОК»), но этот диалог всегда можно снова закрыть напрямую — сама задача продолжает работать в фоновом режиме.
Если обновления уже доступны, их можно импортировать, нажав **Обновить**.

Здесь открывается веб-консоль, и вы можете следить за ходом выполнения.

<details><summary>веб-консоль</summary>

![веб-консоль](../../de/install/media/proxmox/web-konsole)

</детали>

Конечно, также возможно обновить сервер Proxmox через командную строку (например, через SSH):

~~~ apt update && apt dist-upgrade ~~~

Единственное, что здесь важно, это то, что вы используете **apt dist-upgrade** (на «обычных» машинах с Debian/Ubuntu вы, как правило, используете apt upgrade). Тем не менее, «dist-upgrade» важен для Proxmox, поскольку зависимости, необходимые для работы Proxmox, здесь разрешаются лучше.

В этом отношении базовая конфигурация Proxmox теперь завершена. Если вы хотите более подробно разобраться с Proxmox, стоит взглянуть на [Proxmox Wiki](https://pve.proxmox.com/wiki/Main_Page) или на [официальный форум](https://forum.proxmox.com/).

---

## Proxmox - установка ioBroker на ВМ (виртуальную машину)
?> ***Это заполнитель***.<br><br> Помогите ioBroker и дополните эту статью. Пожалуйста, обратите внимание на [Руководство по стилю ioBroker](https://www.iobroker.net/#de/documentation/community/styleguidedoc.md), чтобы упростить принятие изменений.

<details>

</детали>

---

## Proxmox - Создайте [Контейнеры Linux (LXC)](https://pve.proxmox.com/wiki/Linux_Container) + установку ioBroker впоследствии
В этом примере руководства показано, как создать контейнер LXC (debian11), а затем установить в нем ioBroker.

Для наглядности описания изображений и дополнительную информацию можно открыть.

### 1 - Скачать шаблон контейнера
Во-первых, требуется шаблон, который необходимо загрузить в корневой каталог (локальный) при базовой установке (если не были созданы другие диски).

Для этого перейдите в локальные > Шаблоны контейнеров. При нажатии на **Шаблоны** открывается список выбора. Здесь вы выбираете стандарт debian-11 (яблочко) и нажимаете «Загрузить».

<details><summary>Скачать шаблон</summary>

![местный](../../de/install/media/proxmox/local)

![шаблоны](../../de/install/media/proxmox/templates)

![загрузка шаблона](../../de/install/media/proxmox/template-laden)

</детали>

### 2 - Создать LXC
При нажатии на синюю кнопку **Создать CT** открывается окно, в котором теперь необходимо выполнить следующие настройки.

- Общее: Назначение имени хоста и пароля, указан идентификатор (начинается со 100), но его можно изменить.
- Шаблон: выбор хранилища (локальный) и шаблон (стандарт debian-11)
- Диски: Назначение размера диска (не будьте слишком щедры, вы можете увеличить его в любой момент)
- Процессор: зависит от мощности компьютера (также можно настроить в любое время)
- Память: распределение Ram/Swap (можно настроить в любое время, даже во время работы)
- Сеть: назначение статического IP/CIDR, шлюз, если IPv6 не настроен, устанавливается SLAAC.
- DNS: обычно ничего не меняется (используются значения с хоста)
- Подтвердить: здесь вы снова можете увидеть сводку, если все введено правильно, нажмите **Готово**.

<details><summary>Серия изображений Создать КТ</summary>

![пве](../../de/install/media/proxmox/pve)

![lxc-общий](../../de/install/media/proxmox/lxc-allgemein)

![lxc-шаблон](../../de/install/media/proxmox/lxc-template)

![lxc диски](../../de/install/media/proxmox/lxc-disks)

![lxc процессор](../../de/install/media/proxmox/lxc-cpu)

![LXC память](../../de/install/media/proxmox/lxc-speicher)

![сеть lxc](../../de/install/media/proxmox/lxc-netzwerk)

![lxc-dns](../../de/install/media/proxmox/lxc-dns)

![lxc-подтвердить](../../de/install/media/proxmox/lxc-bestätigen)

![lxc-просмотрщик задач](../../de/install/media/proxmox/lxc-taskviewer)

</детали>

### 3 - Настройка LXC
Теперь, когда контейнер запущен, перейдите в консоль LXC.

<details><summary>приставка</summary>

![lxc консоль](../../de/install/media/proxmox/lxc-konsole)

</детали>

Здесь вы сначала входите в систему как root с ранее назначенным паролем, который был назначен при создании LXC, и сначала обновляете его.

~~~ подходящее обновление && подходящее обновление ~~~

<details><summary>Обновить</summary>

![lxc обновление](../../de/install/media/proxmox/lxc-upgrade)

</детали>

Прямо указано, что часовой пояс еще нужно установить.

~~~ dpkg-reconfigure tzdata ~~~

<details><summary>часовой пояс</summary>

![lxc-tzdata](../../de/install/media/proxmox/lxc-tzdata)

![lxc площадь](../../de/install/media/proxmox/lxc-area)

![lxc-часовой пояс](../../de/install/media/proxmox/lxc-timezone)

</детали>

Теперь будут установлены **sudo** и **curl**. Sudo требуется, как и в следующем шаге, для корректного создания пользователя, который будет использоваться на консоли в дальнейшем. Curl нужен для вызова скрипта установки ioBroker на последнем шаге.

~~~ подходящая установка sudo curl ~~~

<details><summary>переустановить</summary>

![lxc-судо](../../de/install/media/proxmox/lxc-sudo)

</детали>

Теперь создайте будущего пользователя. В этом случае замените «имя пользователя». Назначение пароля пользователю. Остальное можно подтвердить клавишей ENTER.

~~~ имя пользователя adduser ~~~

<details><summary>Создать пользователей</summary>

![lxc-adduser](../../de/install/media/proxmox/lxc-adduser)

</детали>

На последнем этапе перед установкой ioBroker выйдите из системы один раз.

~~~ выход~~~

а затем войдите в систему с новым пользователем. Теперь можно установить iobroker.

<details><summary>выйдите из системы и войдите как пользователь</summary>

![логин пользователя lxc](../../de/install/media/proxmox/lxc-useranmeldung)

</детали>

---

## Установить ioBroker
Все, что вам нужно для установки ioBroker, — это одна команда.

~~~ curl -sLf https://iobroker.net/install.sh | Баш-~~~

Шаги установки разделены на 4 шага, которые выполняются полностью автоматически.

- Установка необходимых компонентов (1/4)
- Создание пользователя и каталога ioBroker (2/4)
- Установка ioBroker (3/4)
- Завершение установки (4/4)

<details><summary>установщики</summary>

![установщик iobroker](../../de/install/media/proxmox/iobroker-installer)

![iobroker-installer1](../../de/install/media/proxmox/iobroker-installer1)

![iobroker-installer2](../../de/install/media/proxmox/iobroker-installer2)

![iobroker-установщик3](../../de/install/media/proxmox/iobroker-installer3)

</детали>

Установка успешно завершена, когда в конце появится следующее.

~~~ ioBroker успешно установлен Откройте http://10.1.1.222:8081 в браузере и приступайте к настройке! ~~~

В то же время это также означает, что ioBroker теперь можно вызывать в браузере по адресу. Если все заработало без проблем, вас встретит установка ioBroker. Теперь осталось всего несколько шагов, которые вы проведете вместе с помощником.

<details><summary>Серия изображений ioBroker Assistant</summary>

![настройка iobroker](../../de/install/media/proxmox/iobroker-setup)

![iobroker-setup1](../../de/install/media/proxmox/iobroker-setup1)

![iobroker-setup2](../../de/install/media/proxmox/iobroker-setup2)

![iobroker-setup3](../../de/install/media/proxmox/iobroker-setup3)

![iobroker-setup4](../../de/install/media/proxmox/iobroker-setup4)

![iobroker-setup5](../../de/install/media/proxmox/iobroker-setup5)

![iobroker-setup6](../../de/install/media/proxmox/iobroker-setup6)

</детали>

Затем вы можете искать устройства и службы. Требуемые адаптеры/экземпляры могут создаваться автоматически.

<details><summary>Поиск устройства/службы серии изображений</summary>

![поиск устройства](../../de/install/media/proxmox/gerätesuche)

![экземпляры](../../de/install/media/proxmox/instanzen)

![iobroker-сделано](../../de/install/media/proxmox/iobroker-fertig)

</детали>

На этом установка ioBroker завершена. Дополнительные адаптеры могут быть установлены в любое время в зависимости от применения и желания.

---

## Proxmox - LXC (контейнеры Linux) -> Прохождение через USB-устройства
В этой части руководства шаг за шагом объясняется, как пройти через USB-устройство (переход через USB) в Proxmox в LXC (контейнер Linux).

С виртуальной машиной можно передать USB-устройство напрямую через веб-интерфейс Proxmox, а с контейнером Linux для этого в настоящее время необходимо редактировать файл конфигурации lxc вручную.

В инструкциях описывается, как интегрировать **Texas Instruments Inc. CC2531** Zigbee Stick, но те же шаги можно использовать аналогично для других Zigbee Stick (ConBee, CC2652P и т. д.) или для других USB-устройств, за исключением сетевых USB-устройств. (Bluetooth/Wlan).

* Для этой части инструкции использовался Proxmox версии 7.1.

### 1.) Соберите информацию об устройстве USB
<details>

Установка SSH-соединения с Proxmox:

~~~ ssh root@ip адрес ~~~

<span style="color:red">**Если USB-устройство уже подключено к хосту Proxmox, отключите его на время.**</span>

Следующая команда выводит список всех подключенных в настоящее время USB-устройств на хосте Proxmox:

~~~ lsusb ~~~

![proxmoxlxc00](../../de/install/media/proxmox/proxmoxlxc00.PNG)

Теперь интегрируемое USB-устройство подключается к хосту Proxmox, и снова выполняется команда lsusb.

![proxmoxlxc01](../../de/install/media/proxmox/proxmoxlxc01.PNG)

На скриншоте видно, что новое устройство с номером шины USB: **001** и номером устройства: **003** указано.

Эта информация необходима для использования следующей команды, например. выведите **старший номер устройства** из устройства:

~~~ ls -l /dev/bus/usb/001/003 ~~~

Важно использовать вывод номера шины USB и номера устройства с помощью команды!

***ls -l /dev/bus/usb/номер-usb-шины/номер-устройства***

![proxmoxlxc02](../../de/install/media/proxmox/proxmoxlxc02.PNG)

USB-устройство в этом примере имеет старший номер устройства **189**, запишите значение вашего устройства в текстовом файле с комментарием: #1

![proxmoxlxc03](../../de/install/media/proxmox/proxmoxlxc03.PNG)

Затем мы выводим уникальный идентификатор USB-устройства и записываем выходное значение в текстовый файл с пометкой: #2

~~~ ls /dev/serial/by-id/ ~~~

![proxmoxlxc04](../../de/install/media/proxmox/proxmoxlxc04.PNG)

![proxmoxlxc05](../../de/install/media/proxmox/proxmoxlxc05.PNG)

В качестве последнего шага выводится основной номер устройства ttyACM и отмечается примечанием: #3:

~~~ ls -l /dev/ttyACM* ~~~

![proxmoxlxc06](../../de/install/media/proxmox/proxmoxlxc06.PNG)

>*Если вывода нет, проверьте с помощью «ls -l /dev/serial/by-id/», интегрируется ли USB-устройство в систему как ttyUSB, если да, замените все следующие команды, которые ссылаются на **ttyACM. ..* * получить от **ttyUSB…** если нет вывода, это не устройство класса USB CDC (последовательная связь), поэтому все точки, которые нужно включить из ttyACM, можно игнорировать.*

Итак, мы записали **три** значения с USB-устройства, необходимые для интеграции в конфигурационный файл lxc.

![proxmoxlxc07](../../de/install/media/proxmox/proxmoxlxc07.PNG)

</детали>

### 2.) Отредактируйте файл конфигурации LXC
<details>

Перейдите в каталог конфигурации LXC на хосте Proxmox с помощью:

~~~ cd /etc/pve/lxc ~~~

Файл конфигурации имеет тот же идентификационный номер, который был присвоен при создании lxc!

![proxmoxlxc08](../../de/install/media/proxmox/proxmoxlxc08.PNG)

![proxmoxlxc09](../../de/install/media/proxmox/proxmoxlxc09.PNG)

Перед редактированием конфигурационного файла необходимо создать резервную копию:

~~~ cp 201.conf 201.conf.backup ~~~

![proxmoxlxc10](../../de/install/media/proxmox/proxmoxlxc10.PNG)

Теперь файл конфигурации редактируется с помощью vi или nano:

~~~ нано 201.conf ~~~

![proxmoxlxc11](../../de/install/media/proxmox/proxmoxlxc11.PNG)

В конец конфигурационного файла добавляется следующее:

~~~ lxc.cgroup2.devices.allow: c 189:* rwm lxc.mount.entry: usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0012023529-if00 dev/serial/by-id/usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B00

lxc.cgroup2.devices.allow: c 166:* rwm lxc.mount.entry: /dev/ttyACM0 dev/ttyACM0 нет привязки, необязательный, создать=файл ~~~

Замените отмеченные значения на отмеченные записи из вашей заметки!

![12](../../de/install/media/proxmox/proxmoxlxc12.PNG)

* Первая строка относится к основному номеру устройства **189** Примечание: #1
* Во второй строке уникальный идентификатор (usb-Texas_Instruments_TI_CC2531_USB_CDC___0X00124B0012023529-if00) из Примечание: #2 дается индивидуально и с абсолютным путем, обратите внимание, что полный текст пишется в одну строку без переносов строк.
* В третьей строке указан основной номер устройства **166** от ttyACM из примечания №3.

Сохраните файл конфигурации (в редакторе nano комбинацией клавиш: CTRL+o & CTRL+x для выхода из редактора)

</br>

<span style="color:orange">**ВНИМАНИЕ! – Если в вашем контейнере есть активные моментальные снимки:**</span>

<details>

Тогда код lxc.cgroup находится не в конце конфигурационного файла, а перед первой записью моментального снимка.

![proxmoxlxc18](../../de/install/media/proxmox/proxmoxlxc18.PNG)

</детали>

<span style="color:orange">**ВНИМАНИЕ! - Установка Proxmox до версии 7.0:**</span>

<details>

Замените записи на

~~~ lxc.cgroup2 ~~~

через

~~~ lxc.cgroup ~~~

</детали>

</br> Наконец, введите следующую команду, чтобы установить необходимые права для ttyACM0:

~~~ chmod o+rw /dev/ttyACM* ~~~

Чтобы применить корректировки к lxc, выполните холодную перезагрузку из контейнера с **pct stop id/pct start id**:

~~~ пкт стоп 201 ~~~

~~~ начало пкт 201 ~~~

</br>

<span style="color:green">**Совет: лучше всего хранить копию вашего рабочего файла конфигурации извне, т.к. B. встроенный сервис резервного копирования Proxmox не создает резервную копию содержимого вашей конфигурации!**</span>

</br>

</детали>

### 3.) Проверьте сквозную передачу USB LXC и конфигурацию экземпляра Zigbee.
<details>

Установка SSH-подключения к LXC:

~~~ ssh user@ip адрес ~~~

С помощью команд:

~~~ lsusb ~~~

&

~~~ ls -l /dev ~~~

проверяется, были ли корректировки в файле конфигурации успешными.

![proxmoxlxc13](../../de/install/media/proxmox/proxmoxlxc13.PNG)

* Как видно на скриншоте, контейнер теперь имеет доступ к USB-устройству.

* Важно, что ttyACM0 имеет такие же права на скриншоте, т.е. **crw-rw-rw- 1 Nobody nogroup**

>***Если вы не проверите, все ли значения в конфигурационном файле установлены, как описано, права все равно не должны совпадать, тогда переходите к пункту 5.***

* На снимке экрана также видно, что номер устройства cc2531 изменился с 3 на 4, это связано с тем, что флешка в это время была отключена и снова подключена. Однако, поскольку в конфигурационном файле указан уникальный идентификатор, а не номер шины/устройства, сквозная передача через USB продолжает работать.

Если, как описано выше, в контейнер пропущена Zigbee-флешка, ее необходимо прописать в iobroker в настройках Zigbee-адаптера под именем COM-порта.

~~~ /dev/ttyACM0 ~~~

указывается таким образом, чтобы адаптер обращался к правильному устройству.

![proxmoxlxc14](../../de/install/media/proxmox/proxmoxlxc14.PNG)

</детали>

### 4.) Правило UDEV для постоянных прав Настройка ttyACM0
<details>

В конце шага 3 использовалась команда

~~~ chmod o+rw /dev/ttyACM* ~~~

соответствующие права установлены для ttyACM0, но изменения этих прав сбрасываются при перезапуске хоста Proxmox.На хосте Proxmox требуется правило udev для постоянной настройки.

С помощью lsusb мы снова выводим список подключенных в данный момент USB-устройств:

~~~ lsusb ~~~

![proxmoxlxc15](../../de/install/media/proxmox/proxmoxlxc15.PNG)

На этот раз мы записываем числовые значения после ID в данном случае **0451:16a8**

* Первое значение: ***0451*** означает **idVendor**, а второе значение: ***16a8*** — **idProduct**.

Теперь правило udev создается в /etc/udev/rules.d с помощью vi или nano:

~~~ нано /etc/udev/rules.d/50-myusb.rules ~~~

и добавил следующий контент:

~~~ ПОДСИСТЕМЫ=="usb", ATTRS{idVendor}=="0451", ATTRS{idProduct}=="16a8", GROUP="users", MODE="0666" ~~~

![proxmoxlxc16](../../de/install/media/proxmox/proxmoxlxc16.PNG)

Наконец, выполните следующую команду, чтобы активировать правило udev:

~~~ udevadm control – перезагрузка ~~~

</детали>

### 5.) Устранение неполадок
<details>

**Ошибка:** права ttyACM0 в lxc не совпадают или теряются через короткое время (ConBee II).

~~~ ls -l /dev/ttyACM0 c--------- 0 Nobody nogroup 166, 0 7 февраля 14:29 ttyACM0 ~~~

</br>

**Решение.** Используйте mknod для создания постоянной привязки для контейнера.

Для этого создается папка **devices** по пути **"/var/lib/lxc/CONTAINERID"** и создается привязка в этой папке с помощью mknod:

~~~ mkdir /var/lib/lxc/201/devices ~~~

~~~ cd /var/lib/lxc/201/devices ~~~

~~~ mknod -m 666 ttyACM0 c 166 0 ~~~

+ *mknod создает в пути файл с именем ttyACM0 (пока файл существует, устройство привязано к lxc)*

![proxmoxlxc17](../../de/install/media/proxmox/proxmoxlxc17.PNG)

***основной номер устройства и ttyACM.. при необходимости отрегулируйте***

Затем необходимо изменить запись в конфигурационном файле lxc:

~~~ lxc.mount.entry: /dev/ttyACM0 dev/ttyACM0 нет привязки, необязательный, создать=файл ~~~

будет заменен на:

~~~ lxc.mount.entry: /var/lib/lxc/CONTAINERID/devices/ttyACM0 dev/ttyACM0 нет привязки, необязательный, создать=файл ~~~

</детали>